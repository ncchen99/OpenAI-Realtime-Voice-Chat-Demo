# ğŸ¤ OpenAI Realtime Voice Chat API

ä¸€å€‹åŸºæ–¼ FastAPI çš„å³æ™‚èªéŸ³å°è©±æ‡‰ç”¨ç¨‹å¼ï¼Œç›´æ¥ä¸²æ¥ OpenAI çš„ Realtime APIï¼Œæä¾›ä½å»¶é²çš„èªéŸ³å°èªéŸ³ï¼ˆSpeech-to-Speechï¼‰é«”é©—ã€‚

| èªéŸ³å°è«‡æ¨¡å¼               | æ–‡å­—èŠå¤©æ¨¡å¼              |
| -------------------------- | ------------------------- |
| ![image](./docs/voice.png) | ![image](./docs/text.png) |

## ğŸŒŸ åŠŸèƒ½ç‰¹è‰²

âœ… **é›™æ¨¡å¼åˆ†é **: èªéŸ³å°è«‡ + æ–‡å­—èŠå¤©ï¼Œç¨ç«‹åˆ‡æ›ä½¿ç”¨  
âœ… **å³æ™‚èªéŸ³å°è©±**: ç›´æ¥èªéŸ³è¼¸å…¥ï¼ŒAI å³æ™‚èªéŸ³å›æ‡‰ï¼ˆç„¡ç–ŠåŠ å•é¡Œï¼‰  
âœ… **Markdown æ”¯æ´**: æ–‡å­—æ¨¡å¼æ”¯æ´å®Œæ•´ Markdown æ ¼å¼é¡¯ç¤º  
âœ… **èªéŸ³è½‰æ–‡å­—**: å°ˆé–€é‡å°ç¹é«”ä¸­æ–‡å„ªåŒ–ï¼Œæ›´æº–ç¢ºçš„èªéŸ³è¾¨è­˜  
âœ… **æ–‡å­—è½‰èªéŸ³**: ä½¿ç”¨ Alloy èªéŸ³æ¨¡å‹ï¼Œæ›´å¿«æ›´è‡ªç„¶çš„èªéŸ³åˆæˆ  
âœ… **èªéŸ³æ´»å‹•æª¢æ¸¬**: å„ªåŒ– VAD åƒæ•¸ï¼Œæ›´å¿«éŸ¿æ‡‰å’Œæ›´æº–ç¢ºæª¢æ¸¬  
âœ… **ä½å»¶é²é€šè¨Š**: åŸºæ–¼ WebSocket çš„å³æ™‚é›™å‘é€šè¨Š  
âœ… **éŸ³é‡æ§åˆ¶**: å¯èª¿æ•´ AI èªéŸ³å›æ‡‰éŸ³é‡  
âœ… **ä¸€éµé€šè©±**: ç¶ è‰²/ç´…è‰²åœ“å½¢æŒ‰éˆ•ï¼Œç°¡åŒ–æ“ä½œæµç¨‹  
âœ… **ç¾åŒ–ç•Œé¢**: åœ“å½¢é ­åƒã€ç¾ä»£åŒ–æ°£æ³¡å°è©±æ¡†ã€æ¼¸å±¤èƒŒæ™¯  

## å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´å¥—ä»¶

```bash
pip install -r requirements.txt
```

### 2. è¨­å®š OpenAI API Key

å»ºç«‹ `.env` æª”æ¡ˆä¸¦åŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š

```env
# OpenAI API è¨­å®š
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

# FastAPI è¨­å®š  
DEBUG=True
HOST=0.0.0.0
PORT=8000
```

#### ğŸ”‘ å¦‚ä½•å–å¾— OpenAI API Key

1. å‰å¾€ OpenAI æ§åˆ¶å°ï¼š[https://platform.openai.com/account/api-keys](https://platform.openai.com/account/api-keys)
2. å»ºç«‹æ–°çš„ API Key ä¸¦è¤‡è£½ä¸‹ä¾†
3. è²¼å…¥ `.env` æª”ä¸­çš„ `OPENAI_API_KEY` è®Šæ•¸

> âš ï¸ **é‡è¦**: è«‹ç¢ºä¿æ‚¨çš„ OpenAI å¸³æˆ¶æœ‰è¶³å¤ çš„é¡åº¦ä¾†ä½¿ç”¨ API

### 3. å•Ÿå‹•æœå‹™

```bash
python main.py
```

æˆ–ä½¿ç”¨ uvicornï¼š

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. é–‹å•Ÿç€è¦½å™¨

å‰å¾€ [http://localhost:8000](http://localhost:8000) é–‹å§‹ä½¿ç”¨ï¼

## API ç«¯é»

### WebSocket ç«¯é»

- **`/realtime-voice`**: èªéŸ³å°è«‡æ¨¡å¼çš„ OpenAI Realtime API ä»£ç† WebSocket
- **`/text-chat`**: æ–‡å­—èŠå¤©æ¨¡å¼çš„ OpenAI Realtime API ä»£ç† WebSocket

### HTTP ç«¯é»

- **`GET /`**: æ¸¬è©¦ç•Œé¢é¦–é 
- **`GET /health`**: å¥åº·æª¢æŸ¥

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### ğŸ¤ èªéŸ³å°è«‡æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰

1. é»æ“Šã€Œ**ğŸ¤ èªéŸ³å°è«‡**ã€åˆ†é ï¼ˆé è¨­å·²é¸ä¸­ï¼‰
2. é»æ“Šç¶ è‰²çš„ã€Œ**ğŸ“ é–‹å§‹é€šè©±**ã€æŒ‰éˆ•
3. æŒ‰éˆ•è®Šç‚ºç´…è‰²ã€Œ**ğŸ“ é€šè©±ä¸­**ã€ï¼Œç³»çµ±è‡ªå‹•ï¼š
   - å»ºç«‹èˆ‡ OpenAI Realtime API çš„é€£æ¥
   - é–‹å§‹èªéŸ³éŒ„éŸ³å’Œç›£è½
4. ç›´æ¥å°è‘—éº¥å…‹é¢¨èªªè©±ï¼ŒAI æœƒï¼š
   - è‡ªå‹•åµæ¸¬æ‚¨çš„èªéŸ³é–‹å§‹å’ŒçµæŸ
   - å³æ™‚è½‰éŒ„æ‚¨çš„èªéŸ³å…§å®¹ï¼ˆé‡å°ç¹é«”ä¸­æ–‡å„ªåŒ–ï¼‰
   - ç”¨è‡ªç„¶çš„èªéŸ³å³æ™‚å›æ‡‰ï¼ˆç„¡ç–ŠåŠ å•é¡Œï¼Œä½¿ç”¨ Alloy èªéŸ³ï¼‰
5. æƒ³è¦çµæŸé€šè©±æ™‚ï¼Œå†æ¬¡é»æ“Šç´…è‰²çš„ã€Œ**ğŸ“ é€šè©±ä¸­**ã€æŒ‰éˆ•

### ğŸ’¬ æ–‡å­—èŠå¤©æ¨¡å¼

1. é»æ“Šã€Œ**ğŸ’¬ æ–‡å­—èŠå¤©**ã€åˆ†é åˆ‡æ›åˆ°æ–‡å­—æ¨¡å¼
2. é»æ“Šã€Œ**ğŸ”— é€£æ¥æ–‡å­—æ¨¡å¼**ã€æŒ‰éˆ•å»ºç«‹é€£æ¥
3. åœ¨æ–‡å­—è¼¸å…¥æ¡†ä¸­è¼¸å…¥æ‚¨çš„å•é¡Œï¼ˆæ”¯æ´å¤šè¡Œè¼¸å…¥ï¼‰
4. é»æ“Šã€Œ**ç™¼é€**ã€æŒ‰éˆ•æˆ–æŒ‰ä¸‹ `Enter` éµç™¼é€
5. AI å°‡ä»¥ **Markdown æ ¼å¼**å›æ‡‰ï¼Œæ”¯æ´ï¼š
   - **ç²—é«”**ã€*æ–œé«”*æ–‡å­—
   - # æ¨™é¡Œå’Œå­æ¨™é¡Œ
   - - åˆ—è¡¨é …ç›®
   - `ç¨‹å¼ç¢¼` å’Œç¨‹å¼ç¢¼å€å¡Š
   - é€£çµå’Œå…¶ä»– Markdown èªæ³•

### ğŸ”§ åŠŸèƒ½æ§åˆ¶

- **éŸ³é‡æ§åˆ¶**ï¼šä½¿ç”¨ç•Œé¢ä¸Šçš„éŸ³é‡æ»‘æ¡¿èª¿æ•´ AI èªéŸ³å›æ‡‰çš„éŸ³é‡ï¼ˆ0% - 100%ï¼‰
- **æ¸…é™¤å°è©±**ï¼šé»æ“Šã€ŒğŸ—‘ï¸ æ¸…é™¤ã€æŒ‰éˆ•æ¸…ç©ºç•¶å‰æ¨¡å¼çš„å°è©±è¨˜éŒ„
- **æ¨¡å¼åˆ‡æ›**ï¼šå…©ç¨®æ¨¡å¼æœ‰ç¨ç«‹çš„å°è©±æ­·å²è¨˜éŒ„å’Œé€£æ¥ç‹€æ…‹

> **ğŸ’¡ æç¤º**ï¼š
> - èªéŸ³æ¨¡å¼ä¸­ä¹Ÿå¯ä»¥ç™¼é€æ–‡å­—è¨Šæ¯é€²è¡Œæ··åˆå°è©±
> - æ–‡å­—æ¨¡å¼ä¸­æŒ‰ `Shift + Enter` å¯æ›è¡Œï¼Œå–®ç¨æŒ‰ `Enter` ç™¼é€è¨Šæ¯
> - å³ä¸‹è§’ç‹€æ…‹æ¬„æœƒé¡¯ç¤ºé€£æ¥ç‹€æ…‹å’Œç•¶å‰æ“ä½œç‹€æ…‹

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

- **å¾Œç«¯æ¡†æ¶**: FastAPI
- **å³æ™‚é€šè¨Š**: WebSocket (å®¢æˆ¶ç«¯ â†” å¾Œç«¯ â†” OpenAI Realtime API)
- **AI æœå‹™**: OpenAI Realtime API (gpt-4o-realtime-preview)
- **èªéŸ³è™•ç†**: 
  - èªéŸ³è½‰æ–‡å­—ï¼šå…§å»º Whisper æ¨¡å‹
  - æ–‡å­—è½‰èªéŸ³ï¼šå…§å»º TTS å¼•æ“ (alloy èªéŸ³)
  - éŸ³é »æ ¼å¼ï¼šPCM16 (24kHz, 16-bit, å–®éŸ³é“)
- **èªéŸ³æª¢æ¸¬**: æœå‹™å™¨ç«¯èªéŸ³æ´»å‹•æª¢æ¸¬ (Server VAD)
- **å‰ç«¯**: åŸç”Ÿ HTML/JavaScript + Web Audio API

## å°ˆæ¡ˆçµæ§‹

```
OpenAI-Realtime/
â”‚
â”œâ”€â”€ main.py                 # FastAPI ä¸»ç¨‹å¼
â”œâ”€â”€ static/                 # å‰ç«¯éœæ…‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html         # ä¸»é é¢
â”‚   â”œâ”€â”€ style.css          # æ¨£å¼æª”æ¡ˆ
â”‚   â””â”€â”€ script.js          # JavaScript é‚è¼¯
â”œâ”€â”€ .env                   # ç’°å¢ƒè®Šæ•¸ï¼ˆéœ€æ‰‹å‹•å»ºç«‹ï¼‰
â”œâ”€â”€ requirements.txt       # ç›¸ä¾å¥—ä»¶
â”œâ”€â”€ start.bat             # Windows å¿«é€Ÿå•Ÿå‹•è…³æœ¬
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥æª”æ¡ˆ
â””â”€â”€ README.md             # ä½¿ç”¨èªªæ˜
```

## ğŸ”§ é–‹ç™¼èªªæ˜

### OpenAI Realtime API äº‹ä»¶

æœ¬æ‡‰ç”¨ä½œç‚º WebSocket ä»£ç†ï¼Œç›´æ¥è½‰ç™¼ OpenAI Realtime API äº‹ä»¶ï¼š

#### ä¸»è¦å®¢æˆ¶ç«¯äº‹ä»¶ (ç™¼é€åˆ°æœå‹™å™¨)

- **`input_audio_buffer.append`**: ç™¼é€éŸ³é »æ•¸æ“š
- **`conversation.item.create`**: å»ºç«‹å°è©±é …ç›® (æ–‡å­—è¨Šæ¯)
- **`response.create`**: è«‹æ±‚ AI å›æ‡‰
- **`response.cancel`**: å–æ¶ˆç•¶å‰å›æ‡‰

#### ä¸»è¦æœå‹™å™¨äº‹ä»¶ (å¾æœå‹™å™¨æ¥æ”¶)

- **`session.created`**: æœƒè©±å»ºç«‹æˆåŠŸ
- **`conversation.item.input_audio_transcription.completed`**: èªéŸ³è½‰æ–‡å­—å®Œæˆ
- **`response.audio_transcript.delta`**: AI å›æ‡‰æ–‡å­—ä¸²æµ
- **`response.audio.delta`**: AI å›æ‡‰éŸ³é »ä¸²æµ
- **`input_audio_buffer.speech_started/stopped`**: èªéŸ³æ´»å‹•æª¢æ¸¬

### éŸ³é »è™•ç†

- **è¼¸å…¥æ ¼å¼**: PCM16, 24kHz, å–®éŸ³é“
- **è¼¸å‡ºæ ¼å¼**: PCM16, 24kHz, å–®éŸ³é“
- **ç·¨ç¢¼**: Base64 ç·¨ç¢¼çš„éŸ³é »æ•¸æ“š
- **ç·©è¡**: 4096 æ¨£æœ¬å¡Šè™•ç†

## âš ï¸ æ³¨æ„äº‹é …

- **ç€è¦½å™¨è¦æ±‚**: æ”¯æ´ Web Audio API å’Œ WebRTC
- **éº¥å…‹é¢¨æ¬Šé™**: é¦–æ¬¡ä½¿ç”¨éœ€æˆæ¬Šéº¥å…‹é¢¨å­˜å–æ¬Šé™
- **ç¶²è·¯ç’°å¢ƒ**: å»ºè­°åœ¨ç©©å®šçš„ç¶²è·¯ç’°å¢ƒä¸‹ä½¿ç”¨
- **HTTPS**: ç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ HTTPS å”è­°
- **API æˆæœ¬**: OpenAI Realtime API æŒ‰åˆ†é˜è¨ˆè²»
  - éŸ³é »è¼¸å…¥ï¼šç´„ $0.06/åˆ†é˜
  - éŸ³é »è¼¸å‡ºï¼šç´„ $0.24/åˆ†é˜
- **å»¶é²**: æ­£å¸¸æƒ…æ³ä¸‹ç«¯å°ç«¯å»¶é² < 1 ç§’

## ğŸ” ç–‘é›£æ’è§£

### ç„¡æ³•é€£æ¥ OpenAI Realtime API
- æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºè¨­å®šä¸”æœ‰æ•ˆ
- ç¢ºèª OpenAI å¸³æˆ¶æœ‰ Realtime API ä½¿ç”¨æ¬Šé™
- æª¢æŸ¥å¸³æˆ¶é¡åº¦æ˜¯å¦å……è¶³
- ç¢ºèªç¶²è·¯é€£ç·šç©©å®š

### èªéŸ³åŠŸèƒ½ç„¡æ³•ä½¿ç”¨
- ç¢ºèªç€è¦½å™¨å·²æˆäºˆéº¥å…‹é¢¨æ¬Šé™
- æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Web Audio API
- å˜—è©¦é‡æ–°æ•´ç†é é¢æˆ–é‡å•Ÿç€è¦½å™¨
- åœ¨ HTTPS ç’°å¢ƒä¸‹æ¸¬è©¦

### éŸ³é »æ’­æ”¾å•é¡Œ
- æª¢æŸ¥éŸ³é‡æ»‘æ¡¿è¨­å®š
- ç¢ºèªç³»çµ±éŸ³é‡æœªéœéŸ³
- å˜—è©¦ä½¿ç”¨ä¸åŒç€è¦½å™¨æ¸¬è©¦
- æª¢æŸ¥éŸ³é »è¼¸å‡ºè¨­å‚™

### WebSocket é€£ç·šå•é¡Œ
- ç¢ºèªå¾Œç«¯æœå‹™æ­£å¸¸é‹è¡Œ (http://localhost:8000/health)
- æª¢æŸ¥é˜²ç«ç‰†æˆ–ä»£ç†è¨­å®š
- é©—è­‰åŸ è™Ÿ 8000 æœªè¢«å…¶ä»–æ‡‰ç”¨ä½”ç”¨
- æŸ¥çœ‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·çš„ç¶²è·¯æ¨™ç±¤

### æ•ˆèƒ½æœ€ä½³åŒ–
- é—œé–‰ä¸å¿…è¦çš„ç€è¦½å™¨æ¨™ç±¤
- ç¢ºä¿ç©©å®šçš„ç¶²è·¯é€£ç·š
- åœ¨å®‰éœçš„ç’°å¢ƒä¸­ä½¿ç”¨ä»¥æå‡èªéŸ³è­˜åˆ¥æº–ç¢ºåº¦

## ğŸ‰ ç¸½çµ

æ­¤å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ OpenAI çš„ Realtime API å»ºç«‹ä¸€å€‹åŠŸèƒ½å®Œæ•´çš„å³æ™‚èªéŸ³å°è©±ç³»çµ±ã€‚é€é WebSocket ä»£ç†æ¶æ§‹ï¼Œå¯¦ç¾äº†ï¼š

- ğŸ¤ **è‡ªç„¶çš„èªéŸ³å°è©±é«”é©—**
- ğŸ”„ **å³æ™‚é›™å‘éŸ³é »ä¸²æµ**  
- ğŸ“ **åŒæ­¥æ–‡å­—è½‰éŒ„é¡¯ç¤º**
- ğŸ›ï¸ **å½ˆæ€§çš„éŸ³é »æ§åˆ¶**

é€™å€‹è§£æ±ºæ–¹æ¡ˆé©åˆç”¨æ–¼ï¼š
- èªéŸ³åŠ©æ‰‹æ‡‰ç”¨é–‹ç™¼
- å®¢æœç³»çµ±æ•´åˆ
- æ•™è‚²è¨“ç·´å¹³å°
- ç„¡éšœç¤™è¼”åŠ©å·¥å…·

## æˆæ¬Š

MIT License 